# Some Cygnus tools stuff
SHELL         = /gnuwin32/b18/H-i386-cygwin32/bin/sh
# All of our include paths go here: we need both the JDK and OpenGL headers.
INCLUDES      = -I/jdk1.1.4/include -I/jdk1.1.4/include/cygnus \
	        -I/razeh/openGL/include
DLLTOOL       = dlltool
JAVAH         = javah
SRC           = OpenGL_OpenGLWidget.c OpenGLNativeMethods.c init.c fixup.c \
	        EventHandling.c OpenGL_GLUQuadric.c OpenGLUNativeMethods.c \
	        OpenGL_GLUNurbs.c DCDictionary.c ErrorHandling.c \
	        memory.c EventConversion.c JNIInterface.c
OBJS          = OpenGL_OpenGLWidget.o OpenGLNativeMethods.o init.o fixup.o \
	        EventHandling.o OpenGL_GLUQuadric.o OpenGLUNativeMethods.o \
	        OpenGL_GLUNurbs.o DCDictionary.o ErrorHandling.o \
                memory.o EventConversion.o JNIInterface.o
CFLAGS        = $(INCLUDES) -g -Wall
LIBPATH       = /gnuwin32/b18/H-i386-cygwin32/i386-cygwin32/lib
LIBS          = $(LIBPATH)/libcygwin.a $(LIBPATH)/libopengl32.a \
                $(LIBPATH)/libkernel32.a $(LIBPATH)/libgdi32.a \
                $(LIBPATH)/libuser32.a $(LIBPATH)/libglu32.a 
INSTALLDIR    = ..
INSTALL       = cp
NATIVEHEADERS = OpenGL_OpenGLWidget.h \
		OpenGL_GLUQuadric.h OpenGL_GLUNurbs.h \
	        OpenGL_GLUTriangulator.h OpenGL_OpenGLContext.h \
                OpenGL_OpenGLVertexPointer.h OpenGL_OpenGLCanvas.h

# The entry point for our DLL.
DLLENTRYPOINT = _DllMain@12

all: $(OBJS) OpenGL4java.a

install: all
#	$(INSTALL) OpenGL4java.dll $(INSTALLDIR)

clean:
	$(RM) $(OBJS) *.dll *.def *.exp *.a $(NATIVEHEADERS) *~

OpenGL4java.def: $(OBJS)
	echo EXPORTS > $@
	nm $(OBJS)| grep '^........ [T] _' | sed 's/[^_]*_//' >> $@

OpenGL4java.dll: OpenGL4java.def
	$(LD) --base-file OpenGL4java.base --dll -o $@ $(OBJS)\
                $(LIBS) -e $(DLLENTRYPOINT)
	$(DLLTOOL) --as=as --dllname $@ --def $< --base-file OpenGL4java.base\
		--output-exp OpenGL4java.exp
	$(LD) --base-file OpenGL4java.base OpenGL4java.exp --dll -o $@ \
		$(OBJS) $(LIBS) -e $(DLLENTRYPOINT)
	$(DLLTOOL) --as=as --dllname $@ --def $< --base-file OpenGL4java.base\
		--output-exp OpenGL4java.exp
	$(LD) OpenGL4java.exp --dll -o $@ $(OBJS) $(LIBS) -e $(DLLENTRYPOINT)

OpenGL4java.a: OpenGL4java.dll
	$(DLLTOOL) --as=as --dllname $< --def OpenGL4java.def --output-lib $@



OpenGL_OpenGLWidget.h:
	(cd ..; make $@)
OpenGL_GLUQuadric.h:
	(cd ..; make $@)
OpenGL_GLUNurbs.h:
	(cd ..; make $@)
OpenGL_GLUTriangulator.h:
	(cd ..; make $@)
OpenGL_OpenGLVertexPointer.h:
	(cd ..; make $@)
OpenGL_OpenGLContext.h:
	(cd ..; make $@)
# Depends
OpenGL_OpenGLWidget.c: OpenGL_OpenGLWidget.h cygnusFixes.h memory.h \
                       JNIInterface.h EventHandling.h ErrorHandling.h
OpenGLNativeMethods.c: OpenGL_OpenGLWidget.h cygnusFixes.h ErrorHandling.h
OpenGLUNativeMethods.c: OpenGL_OpenGLWidget.h cygnusFixes.h
EventHandling.c: EventHandling.h 
OpenGL_GLUQuadric.c: OpenGL_GLUQuadric.h cygnusFixes.h
OpenGL_GLUNurbs.c: OpenGL_GLUNurbs.h cygnusFixes.h

